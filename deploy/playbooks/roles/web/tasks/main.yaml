- name: Deploy nginx configs
  template: src=configs/nginx/sites-enabled/{{ APP }}
    dest=/etc/nginx/sites-enabled/{{ nginx.config_name }}
    owner=root
    group=root
    mode=0644

- name: Copy upstart configs
  copy: src=configs/upstart/{{ APP }}.conf
    dest=/etc/init/{{ upstart.config_name }}
    owner=root
    group=root
    mode=0644

- name: Update codebase
  git: repo=git@bitbucket.org:avaea_eng/avaea.git
    dest="{{ dir }}"
    version="{{ GIT_BRANCH }}"
    update=yes
    clone=no
    accept_hostkey=yes
    force=yes
    key_file=/root/.ssh/bitbucket_rsa

- name: Restart demo service
  service: name="{{ APP }}" state=restarted

- name: Restart abo service
  service: name="{{ APP }}" state=restarted
