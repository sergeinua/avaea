image: avaea/demo
#image: spittet/node-postgresql
pipelines:
  default:
    - step:
        script:
          - echo "This script runs on all branches that don't have any specific pipeline assigned in 'branches'."
  branches:
    DEMO-806*:
      - step:
          script:
#              - apt update
#               - apt-get -y install postgresql postgresql-contrib
#              - apt-get -y install net-tools
              - /etc/init.d/postgresql start
#              - apt-get install --reinstall sudo
#              - sudo -u postgres sh -c 'createuser avaea & createdb avaea'
#              - sudo -u postgres psql -c "ALTER USER avaea PASSWORD 'avaea';" 
#              - sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE avaea to avaea;"
#              - sudo -u postgres sh -c 'psql -d avaea  < avaea.sql'
#              - npm install pg
              - node -v
              - npm -v
              - psql -V
              - cd src
              - npm install
#              - curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash
#              - apt-get -y install nodejs
              #              - ./node_modules/sails/bin/sails.js lift --verbose &
#             - iptable-save
#             - PGPASSWORD=
#             - pwd
#              - ls
              - export NODE_ENV="staging"
              - export GOOGLE_OAUTH_CLIENT_ID="353849264959-s6n15fmj0s094hs95b46s5osuikm2agi.apps.googleusercontent.com"
              - export GOOGLE_OAUTH_CLIENT_SECRET="wURGldrAW0CS1kS8PX1QJi1m" 
              - make test-unit
              - make test-integration
