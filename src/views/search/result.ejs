<nav id="tiles_ui" class="navbar navbar-default navbar-fixed-top container-fluid<% if (typeof searchResult == 'undefined' || !searchResult.length) { %> hidden<% } %>">
  <div class="flight-info row hide">
    <div class="col-xs-8 result-search-info-bar">
      <div style="float: left; width: auto;">
        <%if (title) {%><span class="requested-airports"><%= title %></span><% } %>
        <% if (typeof searchResult != 'undefined') { %>
        <span class="flight-type"><% if (searchParams.returnDate) { %><%= __('Round trip') %><%} else {%><%= __('One way') %><%}%></span>
      </div>
      <div style="float: left; width: auto;">
        <span class="flight-date"><%= searchParams.departureDate %>
          <% if (searchParams.returnDate) { %> - <%= searchParams.returnDate %><% } %>
          <span class="text-spacer"></span>
          <%= searchParams.CabinClass %>
          <span class="text-spacer"></span>
          <span class="passengers_count"><%= searchParams.passengers %></span>
          <span id="user-icon-small" class="glyphicon glyphicon-user"></span>
        </span>
        <% }%>
      </div>
    </div>
    <div class="col-xs-4 text-right">
      <% if (typeof searchResult != 'undefined' && searchResult.length) { %>
      <div style="float: right; width: auto;" class="text-right">
        <div style="float: right; min-width: 30px; margin-top:-3px;" class="text-right">
          <div class="sort-button">
            <button class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="fa fa-usd" aria-hidden="true"></i>  <span id="sort-menu-direction">&darr;</span>
            </button>
            <ul class="dropdown-menu">
              <%
                var sortOptions = {
                  price: {
                    icon: '<i class="fa fa-usd" aria-hidden="true"></i>',
                    title: __('Price')
                  },
                  smart: {
                    icon: '<i class="fa fa-lightbulb-o" aria-hidden="true"></i>',
                    title: __('Smart Rank')
                  },
                  duration: {
                    icon: '<i class="fa fa-clock-o" aria-hidden="true"></i>',
                    title: __('Duration')
                  },
                  odepart: {
                    icon: '<i class="fa fa-plane" aria-hidden="true"></i>',
                    title: __('Departure')
                  },
                  oarrival: {
                    icon: '<i class="fa fa-plane fa-flip-vertical" aria-hidden="true"></i>',
                    title: __('Arrival')
                  }
                };
                if (searchParams.returnDate) {
                  sortOptions.duration.title += '&#8644;';
                  sortOptions.idepart =  {
                    icon: '<i class="fa fa-plane fa-flip-horizontal" aria-hidden="true"></i>',
                    title: searchParams.ArrivalLocationCode + ' ' + sortOptions.odepart.title
                  };
                  sortOptions.iarrival = {
                    icon: '<i class="fa fa-plane fa-rotate-180" aria-hidden="true"></i>',
                    title: searchParams.DepartureLocationCode + ' ' + sortOptions.oarrival.title
                  };
                  sortOptions.odepart.title =  searchParams.DepartureLocationCode + ' ' + sortOptions.odepart.title;
                  sortOptions.oarrival.title = searchParams.ArrivalLocationCode + ' ' + sortOptions.oarrival.title;
                }
                var i=0;
                for (var name in sortOptions) { %>
              <li sort="<%= name %>"<%if (!i) { %> class="selected" order="asc"<% } %>><a href="#"><span class="caret pull-right<%if (i) { %> hide<% } %>"></span><%- sortOptions[name].icon %> <%= sortOptions[name].title %></a></li>
              <% i++; } %>
            </ul>
          </div>
        </div>
        <div class="itin-result-count text-right">
          <span><span id='search_count'><%= searchResult.length %></span> / <%= searchResult.length %></span><br/>
        </div>
      </div>

      <div class="clear-undo-buttons text-right">
        <span id="clear" class="clear-all-filters disabled"><%= __('Clear') %></span> &middot;
        <span id="undo" class="undo-button disabled"><%= __('Undo')%></span>
      </div>
      <% } %>
    </div>
  </div>
  <% if (typeof timelog != 'undefined' && timelog) { %>
<!--
  <div class="alert alert-danger row">
    <div class="col-xs-12" role="alert" id="timeAlert">
      <p class="text-info" style="color: grey"><%= timelog %></p>
    </div>
  </div>
-->
  <% } %>
  <% if (tiles) { %>
  <div class="row">
    <%- partial('bucket')%>
  </div>
  <div class="selectedfilters row" filters=''></div>
  <% } %>
  <!--div class="total-count row">
    <div class="col-xs-9" style="padding-top: 2px;">
    </div>
    <div class="col-xs-3">
      <input type="checkbox" id="smart" data-toggle="toggle" data-style="lbSmart pull-right" data-size="mini" data-on="<i class='fa fa-lightbulb-o'></i>" data-off="<i class='fa fa-lightbulb-o'></i>">
    </div>
  </div-->
</nav>
<% if (typeof searchResult != 'undefined' && searchResult.length) {%>

<div id="searchResultData" class="row">
  <% iterator = 0, itrMerch = 0; %>
  <% if (searchResult.length) { %>
  <% searchResult.forEach(function (sRes, i) { %>

  <div id="<%= sRes.id %>" for="cli<%= i %>" class="col-xs-12 itinerary <%= sRes.filterClass %>"
     data-smart="<%= sRes.smartRank %>" data-price="<%= sRes.price %>" data-duration="<%= sRes.durationMinutes %>"
     data-odepart="<%= sRes.citypairs[0].from.minutes %>" data-oarrival="<%= sRes.citypairs[0].to.minutes %>"<% if (searchParams.returnDate) { %>
     data-idepart="<%= sRes.citypairs[sRes.citypairs.length - 1].from.minutes %>" data-iarrival="<%= sRes.citypairs[sRes.citypairs.length - 1].to.minutes %>"<% } %>>

    <div class="row">
      <div class="col-xs-12 itinerary-airline col-from-to">
        <span class="itinerary-airline-icon" data-sprite_num="<%= iconSpriteMap[sRes.citypairs[0].from.airlineCode] %>" alt="<%= sRes.citypairs[0].from.airlineCode %>" title="<%= sRes.citypairs[0].from.airline %>"></span>
      <!--</div>-->
      <!--<div class="col-xs-8 itinerary-airline">-->
        <span class="airline-text"><%= sRes.citypairs[0].from.airline %> </span>
        <% if (sRes.smartRank <= 3 && sRes.information && sRes.information.length) { %>
        <span class="glyphicon glyphicon-thumbs-up clickable" style="color:forestgreen;" data-toggle="modal" data-target="#flightInfo<%= i%>"></span>


        <% } %>
      </div>
      <% if (sRes.smartRank <= 3 && sRes.information && sRes.information.length) { %>
      <!-- Modal -->
      <div id="flightInfo<%= i%>" class="modal fade" role="dialog" style="font-family: WhitneyHTF-MediumCondensed; font-size: 16px;">
        <div class="modal-dialog">

          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-body">
              <div class="row">
                <div class="col-xs-6"><%= __('Fare') %></div>
                <div class="col-xs-6 text-right">$<%= sRes.specialprice %></div>
              </div>
              <div class="row">
                <div class="col-xs-11 col-xs-offset-1"><%= __('includes') %>:</div>
              </div>
              <% sRes.information.forEach(function (item) { %>
              <div class="row">
                <div class="col-xs-5 col-xs-offset-1">
                    <span>
                      <span><%= item.name %></span>
                    </span>
                </div>
                <div class="col-xs-6 text-right">$<%= item.price.toFixed(2) %></div>
              </div>
              <% }); %>
              <div class="row" style="border-top: 1px solid #e5e5e5;">
                <div class="col-xs-8"><%= sRes.citypairs[0].from.airline %> <%= __('discount') %>:</div>
                <div class="col-xs-4 text-right">
                  <span style='color:red;'>- $<%= sRes.additionalPrice %></span>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-8"><%= __('Your Price') %>:</div>
                <div class="col-xs-4 text-right">$<%= sRes.price %></div>
              </div>
            </div>
            <div class="modal-footer" style="border-top: none; background-color: #F2F5F8; border-bottom-right-radius: 6px; border-bottom-left-radius: 6px;">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>

        </div>
      </div>
      <% } %>
    </div>

    <div class="row">
      <div class="col-xs-9"  id="<%= sRes.id %>" for="cli<%= i %>" style="line-height: 0.86">
        <% sRes.citypairs.forEach(function (pair) { %>
        <div class="itinerary-info">
          <!--<div class="col-xs-1"></div>-->
          <div class="col-xs-3 text-right">
            <%= pair.from.time %> <%= pair.from.code %></div>
          <div class="col-xs-2 text-center stops-letter-spacing"><% if (pair.noOfStops > 0) { %><span class="visible-xs-inline">&rarr;<%= pair.noOfStops %></span><% } %>&rarr;</div>
          <div class="col-xs-3"><%= pair.to.time %> <%= pair.to.code %></div>
          <div class="col-xs-3"><%= pair.duration %></div>
        </div>
        <% }); %>
      </div>
      <div class="col-xs-3 buy-button">
        <div class="btn-group text-nowrap buy-button-group">
          <button id="buy-button-<%= i %>" class="btn btn-sm btn-primary buy-button-price"><% if(sRes.currency == 'USD') { %>$<%= Math.round(sRes.price) %> <% } else { %><%= Math.round(sRes.price) %> <%= sRes.currency %><% } %></button>
          <button type="button" class="btn btn-sm btn-primary dropdown-toggle buy-button-arrow" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <li><a id="buy-cron-button-<%= i %>" href="#" class="our-dropdown text-center">or better</a></li>
          </ul>
        </div>
      </div>
    </div>



    <div class="row collapse notable-area" id="cli<%= i %>" style="line-height: 1.8"><div class="col-xs-12"><% sRes.citypairs.forEach(function (pair, c) { %>
      <div class="row" style="margin-top: 4px;">

        <div class="col-xs-3"><strong><%= pair.direction %></strong></div>
        <div class="col-xs-9" style="padding: 0">
          <% pair.flights.forEach(function (flight, j) { %>
            <% if (flight.merchandising && flight.merchandising.length) { %>
              <ul class="merchandising">
                <% flight.merchandising.forEach(function (item) {
                  var merchKey = item.toLowerCase().replace(/\W+/g, '_'),
                          merchClass;
                  if (merchKey == '1st_bag_free') {
                    merchClass = 'luggage';
                  } else if (merchKey == 'wifi') {
                    merchClass = 'wifi';
                  } else if (merchKey == 'priority_seat') {
                    merchClass = 'priority_seat';
                  }
                %>
                <li><% if (merchClass) { %><span class="gicon <%= merchClass %>" title="<%= item %>"></span><% } else { %><%= item %><%}%></li>
                <% }); %>
              </ul>
            <% itrMerch++; } %>
          <% }); %>
        </div>

      </div>
      <% pair.flights.forEach(function (flight, j) { %>
      <% if (j > 0) {%>
      <div class="row" style="margin-top: 4px;">
        <div class="col-xs-5 text-nowrap detail-col-left">&#10162; <%= __('Change planes') %></div>
        <div class="col-xs-2 detail-col"><%= pair.stops[j-1].code %></div>
        <div class="col-xs-2 col-xs-offset-3 detail-col"><%= pair.stops[j-1].duration %></div>
      </div>
      <% } %>
      <div class="row">
        <div class="col-xs-3 text-nowrap notable-text detail-col-left">
          <span class="itinerary-airline-icon" data-sprite_num="<%= iconSpriteMap[flight.airlineCode] %>" alt="<%= flight.airlineCode %>" title="<%= flight.airline %>"></span>
          <%= flight.abbrNumber %>
        </div>
        <div class="col-xs-2 text-nowrap detail-col"><%= sails.moment(flight.from.date).format('DD MMM') %></div>
        <div class="col-xs-2 text-nowrap detail-col"><%= flight.from.code %> <%= flight.to.code %></div>
        <div class="col-xs-3 text-nowrap notable-text detail-col"><%= flight.from.time%>&ndash;<%= flight.to.time %></div>
        <div class="col-xs-2 text-nowrap detail-col"><%= flight.duration%><% if (flight.noOfStops > 0) { %>
          <span class="hidden-xs small text-danger">+<%= flight.noOfStops + (parseInt(flight.noOfStops) > 1 ? __(' stops') : __(' stop')) %></span>
          <% } %>
        </div>
      </div><% if (flight.noOfStops > 0) { %><% flight.stops.forEach(function (stop) { %>
      <div class="row">
        <div class="col-xs-5 text-nowrap detail-col-left">&#9675; <%= __('Intermediate stop') %></div>
        <div class="col-xs-2 detail-col"><%= stop.code %></div>
        <div class="col-xs-2 col-xs-offset-3 detail-col"><%= stop.duration %></div>
      </div><% }); %><% } %>
      <% }); %>
    <% }); %></div></div>

    <% iterator++ %>
  </div>

  <% }); %>
  <% } %>
</div>

<style>
    body {
      padding-top: 210px;
    }
</style>

<% } else { %>
<div class="row">
  <div class="col-xs-12 nothing-found">
      <div class="nothing-found-icon"></div>
      <div class="nothing-found-text">No results were found from <%= departure.iata_3code %>, <%= departure.city %> to <%= arrival.iata_3code %>, <%= arrival.city %>.</div>
  </div>
</div>

  <a href="/search"  class="btn btn-sm btn-primary btn-block center-block new-search-button" role="button"><%= __('Start new search') %></a>
<% } %>

<form action="/buy" method="post" id="booking_form" >
  <input type="hidden" name="id" id="_id" value=""/>
  <input type="hidden" name="searchId" id="searchId" value="<%= searchId %>"/>
  <input type="hidden" name="passengers" id="passengers" value="<%= searchParams.passengers %>"/>
</form>

<script>
  var GlobalSearchResultCount = <%= (typeof searchResult != 'undefined') ? searchResult.length : 0  %>;
</script>
